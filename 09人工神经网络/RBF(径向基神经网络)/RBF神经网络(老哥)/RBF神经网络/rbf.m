clear%清理环境
clc
%这里一定要留几行，低版本运行时如果没有几行隔开，clear和clc可能被程序忽略


format long%使用双精度执行所有计算
%% 录入数据，这样录入的方式预测的结果更好些
P_train=[0	0.0001	0.0002	0.0006	0.0009
0.0001	0.0002	0.0006	0.0009	0.001
0.0002	0.0006	0.0009	0.001	0.0006
0.0006	0.0009	0.001	0.0006	-0.0005
0.0009	0.001	0.0006	-0.0005	-0.002
0.001	0.0006	-0.0005	-0.002	-0.0035
0.0006	-0.0005	-0.002	-0.0035	-0.0044
-0.0005	-0.002	-0.0035	-0.0044	-0.0043
-0.002	-0.0035	-0.0044	-0.0043	-0.0031
-0.0035	-0.0044	-0.0043	-0.0031	-0.0012
-0.0044	-0.0043	-0.0031	-0.0012	0.0013
-0.0043	-0.0031	-0.0012	0.0013	0.004
-0.0031	-0.0012	0.0013	0.004	0.007
-0.0012	0.0013	0.004	0.007	0.01004
0.0013	0.004	0.007	0.01004	0.0133
0.004	0.007	0.01004	0.0133	0.0166
0.007	0.01004	0.0133	0.0166	0.0199
0.01004	0.0133	0.0166	0.0199	0.0232
0.0133	0.0166	0.0199	0.0232	0.0265
0.0166	0.0199	0.0232	0.0265	0.0296
0.0199	0.0232	0.0265	0.0296	0.0327
0.0232	0.0265	0.0296	0.0327	0.0356
0.0265	0.0296	0.0327	0.0356	0.0383
0.0296	0.0327	0.0356	0.0383	0.0409
0.0327	0.0356	0.0383	0.0409	0.0434
0.0356	0.0383	0.0409	0.0434	0.0456
0.0383	0.0409	0.0434	0.0456	0.0477
0.0409	0.0434	0.0456	0.0477	0.0496
0.0434	0.0456	0.0477	0.0496	0.0514
0.0456	0.0477	0.0496	0.0514	0.0529
0.0477	0.0496	0.0514	0.0529	0.0543
0.0496	0.0514	0.0529	0.0543	0.0556
0.0514	0.0529	0.0543	0.0556	0.0567
0.0529	0.0543	0.0556	0.0567	0.0576
0.0543	0.0556	0.0567	0.0576	0.0585
0.0556	0.0567	0.0576	0.0585	0.0592
0.0567	0.0576	0.0585	0.0592	0.0597
0.0576	0.0585	0.0592	0.0597	0.0602
0.0585	0.0592	0.0597	0.0602	0.0606
0.0592	0.0597	0.0602	0.0606	0.0609]';                                    
T_train=[0.001
0.0006
-0.0005
-0.002
-0.0035
-0.0044
-0.0043
-0.0031
-0.0012
0.0013
0.004
0.007
0.01004
0.0133
0.0166
0.0199
0.0232
0.0265
0.0296
0.0327
0.0356
0.0383
0.0409
0.0434
0.0456
0.0477
0.0496
0.0514
0.0529
0.0543
0.0556
0.0567
0.0576
0.0585
0.0592
0.0597
0.0602
0.0606
0.0609
0.0611]';
P_test=P_train;%P_test等于P_train
T_test=T_train;%T_test等于T_train
[Pn_train,inputps] = mapminmax(P_train);%mapminmax用法见附件，是一种归一化方法
Pn_test = mapminmax('apply',P_test,inputps);%读取处理后的数据，Pn_test与Pn_train相等
% 测试集
[Tn_train,outputps] = mapminmax(T_train);
Tn_test = mapminmax('apply',T_test,outputps);
eg = 1e-6; % sum-squared error goal径向基函数目标误差
sc = 5000;    % spread constant   5000  is ok径向基函数扩展速度
net = newrb(Pn_train,Tn_train,eg,sc);%RBF网络训练，训练函数为newrb，与bp训练函数有点差别
%% 仿真测试
Tn_sim_optimized = sim(net,Pn_test);     
% 反归一化
T_sim_optimized = mapminmax('reverse',Tn_sim_optimized,outputps);
x0=1:40;%每列有40个数据
plot(x0,T_train,x0,T_sim_optimized);%作图检验
legend('原始','优化');
%开始预测下一个数，下面是小编自己写的，只能预测后面一个数据，这个程序也可以做整体预测，怎么做就自己编了
qw=[0.0001	0.0002	0.0006	0.0009	0.001
0.0002	0.0006	0.0009	0.001	0.0006
0.0006	0.0009	0.001	0.0006	-0.0005
0.0009	0.001	0.0006	-0.0005	-0.002
0.001	0.0006	-0.0005	-0.002	-0.0035
0.0006	-0.0005	-0.002	-0.0035	-0.0044
-0.0005	-0.002	-0.0035	-0.0044	-0.0043
-0.002	-0.0035	-0.0044	-0.0043	-0.0031
-0.0035	-0.0044	-0.0043	-0.0031	-0.0012
-0.0044	-0.0043	-0.0031	-0.0012	0.0013
-0.0043	-0.0031	-0.0012	0.0013	0.004
-0.0031	-0.0012	0.0013	0.004	0.007
-0.0012	0.0013	0.004	0.007	0.01004
0.0013	0.004	0.007	0.01004	0.0133
0.004	0.007	0.01004	0.0133	0.0166
0.007	0.01004	0.0133	0.0166	0.0199
0.01004	0.0133	0.0166	0.0199	0.0232
0.0133	0.0166	0.0199	0.0232	0.0265
0.0166	0.0199	0.0232	0.0265	0.0296
0.0199	0.0232	0.0265	0.0296	0.0327
0.0232	0.0265	0.0296	0.0327	0.0356
0.0265	0.0296	0.0327	0.0356	0.0383
0.0296	0.0327	0.0356	0.0383	0.0409
0.0327	0.0356	0.0383	0.0409	0.0434
0.0356	0.0383	0.0409	0.0434	0.0456
0.0383	0.0409	0.0434	0.0456	0.0477
0.0409	0.0434	0.0456	0.0477	0.0496
0.0434	0.0456	0.0477	0.0496	0.0514
0.0456	0.0477	0.0496	0.0514	0.0529
0.0477	0.0496	0.0514	0.0529	0.0543
0.0496	0.0514	0.0529	0.0543	0.0556
0.0514	0.0529	0.0543	0.0556	0.0567
0.0529	0.0543	0.0556	0.0567	0.0576
0.0543	0.0556	0.0567	0.0576	0.0585
0.0556	0.0567	0.0576	0.0585	0.0592
0.0567	0.0576	0.0585	0.0592	0.0597
0.0576	0.0585	0.0592	0.0597	0.0602
0.0585	0.0592	0.0597	0.0602	0.0606
0.0592	0.0597	0.0602	0.0606	0.0609
0.0597	0.0602	0.0606	0.0609	0.0611]';
qwe=qw;%矩阵相等
[we,input] = mapminmax(qw);%数据处理
er = mapminmax('apply',qwe,input);
rt = sim(net,er);
n=length(rt);%矩阵维度，这里指有多少列
as=rt;%矩阵相等
as(n)=rt(n)/rt(n-1);%一个预测的运算，主要针对最后一个数
sd = mapminmax('reverse',as,outputps);%反归一化
sd(40)%预测结果，注意下每列有40个数